<!-- Modal Cho tổ chức-->
<div class="modal fade" id="kyquyettoantochuc" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="width: 650px;">
        <div class="modal-header">
            <div class="input-group">
                <h5 class="modal-title" id="exampleModalLabel">Mở thời gian quyết toán thuế cho Tổ chức - năm <span class="currentYear"></span></h5>
            </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/mo-ky-quyet-toan-to-chuc" method="post">
            <input name="adminId"  value="<%= admin.id %>" style="display: none;">
            <div class="modal-body mt-2">
                <div class="input-group">
                    <label for="" style="margin-top: 5px;" class="col-3">Thời gian mở: </label>
                    <input type="date" id="ngaymo" name="ngaymo" class="form-control col-9">
                  </div>
                </div>
                <div class="modal-body mt-2">
                  <div class="input-group">
                    <label for="" style="margin-top: 5px;" class="col-3">Thời gian đóng: </label>
                    <input type="date" id="ngaydong" name="ngaydong" class="form-control col-9">
                  </div>

                <div class="input-group mt-1" style="display: none;">
                    <label for="selectOpenTochuc" style="margin-top: 5px;" class="col-3">Chọn kỳ quyết toán: </label>
                    <select name="selectOpenTochuc" id="selectOpenTochuc" class="form-select col-9" onchange="updateDateFields()">
                        <option value="thang">Theo tháng</option>
                        <option value="quy">Theo quý</option>
                        <option value="nam">Theo năm</option>
                    </select>
                </div>
                <div class="input-group mt-4">
                    <label for="openTochuc" style="margin-top: 5px;" class="col-3">Thời gian mở <font style="color: red;">(*)</font></label>
                    <input type="date" id="openTochuc" name="openTochuc" class="form-control col-9" value="">
                </div>
            </div>
            <div class="modal-body mt-1">
                <div class="input-group">
                    <label for="closeTochuc" style="margin-top: 5px;" class="col-3">Thời gian đóng <font style="color: red;">(*)</font></label>
                    <input type="date" id="closeTochuc" name="closeTochuc" class="form-control col-9" value="">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="submit" id="submitBtn" class="btn btn-primary">Mở kỳ quyết toán</button>
            </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    function updateDateFields() {
        var selectOpenTochuc = document.getElementById('selectOpenTochuc');
        var openTochuc = document.getElementById('openTochuc');
        var closeTochuc = document.getElementById('closeTochuc');

        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = currentDate.getMonth() + 1; 
        var lastDayOfMonth = new Date(year, month, 0).getDate();

        if (selectOpenTochuc.value === 'thang') {
            openTochuc.value = year + '-' + (month < 10 ? '0' : '') + month + '-01';
            closeTochuc.value = year + '-' + (month < 10 ? '0' : '') + month + '-' + lastDayOfMonth;
        } else if (selectOpenTochuc.value === 'quy') {
            var startMonth = Math.floor((month - 1) / 3) * 3 + 1;
            var endMonth = startMonth + 2;
            endMonth = endMonth > 12 ? 12 : endMonth;

            openTochuc.value = year + '-' + (startMonth < 10 ? '0' : '') + startMonth + '-01';
            closeTochuc.value = year + '-' + (endMonth < 10 ? '0' : '') + endMonth + '-' + new Date(year, endMonth, 0).getDate();
        } else if (selectOpenTochuc.value === 'nam') {
            openTochuc.value = year + '-01-01';
            closeTochuc.value = year + '-12-31';
        }
    }

    updateDateFields();
</script>